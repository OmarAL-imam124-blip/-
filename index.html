<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“š Ù…ÙƒØªØ¨ØªÙŠ ÙˆÙ…Ù†Ù‡Ø¬ÙŠ</title>

    <!-- 1. Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 2. Google Fonts (Amiri Ù„Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†, Cairo Ù„Ù„Ù†ØµÙˆØµ) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">

    <!-- 3. Ù…ÙƒØªØ¨Ø© html2canvas (Ù„Ø£Ø®Ø° Ù„Ù‚Ø·Ø© Ø´Ø§Ø´Ø© Ù„Ù„ØªØ­Ø¶ÙŠØ±) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <!-- 4. Tailwind Configuration (Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† Ù‡Ùˆ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ) -->
    <script>
        tailwind.config = {
            darkMode: ['class', '.light'], // Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ ÙŠÙØ¹Ù‘Ù„ Ø¨ÙƒÙ„Ø§Ø³ .light
            theme: {
                extend: {
                    colors: {
                        'primary-bg': '#fbfaf6',    // Ø¨ÙŠØ¬ ÙØ§ØªØ­ (Ø®Ù„ÙÙŠØ© Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ)
                        'primary-text': '#5a3a1c',  // Ø¨Ù†ÙŠ Ø¯Ø§ÙƒÙ† (Ù„ÙˆÙ† Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ)
                        'header-bg': '#5a3a1c',   // Ø¨Ù†ÙŠ (Ù„ÙˆÙ† Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ)
                        'accent': '#c7a17a',      // Ø¨Ù†ÙŠ Ø°Ù‡Ø¨ÙŠ (Ù„Ù„ØªØ­Ø¯ÙŠØ¯)
                        'dark-bg': '#111111',     // Ø£Ø³ÙˆØ¯ Ø¯Ø§ÙƒÙ† (Ø§ÙØªØ±Ø§Ø¶ÙŠ)
                        'dark-card': '#2a2a2a',    // Ù„ÙˆÙ† Ø§Ù„ÙƒØ±ÙˆØª (Ø§ÙØªØ±Ø§Ø¶ÙŠ)
                        'dark-text': '#e0e0e0',   // Ù„ÙˆÙ† Ø§Ù„Ù†Øµ (Ø§ÙØªØ±Ø§Ø¶ÙŠ)
                        'success': '#00FF99',     // Ø£Ø®Ø¶Ø± ÙØ§ØªØ­
                        'warning': '#FFA74D',     // Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ
                        'sepia-bg': '#f5deb3',    // Ø®Ù„ÙÙŠØ© Ø§Ù„Ø¯ÙØªØ±
                        'sepia-lines': '#e0cdaf', // Ù„ÙˆÙ† Ø³Ø·ÙˆØ± Ø§Ù„Ø¯ÙØªØ±
                        'sepia-text': '#5D4037',  // Ù„ÙˆÙ† Ù†Øµ Ø§Ù„Ø¯ÙØªØ±
                    },
                    fontFamily: {
                        'amiri': ['Amiri', 'serif'],
                        'cairo': ['Cairo', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <!-- 5. Custom CSS (Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† Ù‡Ùˆ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ + ØªØ£Ø«ÙŠØ± ØªÙ‚Ù„ÙŠØ¨ Ø§Ù„ØµÙØ­Ø§Øª) -->
    <style>
        /* ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø®Ø·ÙˆØ· Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© */
        body {
            font-family: 'Cairo', sans-serif;
            transition: background-color 0.3s, color 0.3s;
            overflow-x: hidden; /* Ù…Ù†Ø¹ Ø§Ù„Ø³ÙƒØ±ÙˆÙ„ Ø§Ù„Ø£ÙÙ‚ÙŠ Ø¨Ø³Ø¨Ø¨ Ø§Ù„ØªÙ‚Ù„ÙŠØ¨ */
        }
        h1, h2, h3, h4, h5, h6, .font-amiri {
            font-family: 'Amiri', serif;
        }
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„ØªØ§Ø¨ Ø§Ù„Ù†Ø´Ø· (Ø¯Ø§ÙƒÙ† Ø§ÙØªØ±Ø§Ø¶ÙŠ) */
        .tab-btn.active {
            border-bottom-color: var(--tw-color-accent) !important;
            color: var(--tw-color-accent) !important;
            font-weight: 700;
        }
        html.light .tab-btn.active {
            border-bottom-color: var(--tw-color-primary-text) !important;
            color: var(--tw-color-primary-text) !important;
        }
        /* Ø¥Ø®ÙØ§Ø¡ Ø³ÙƒØ±ÙˆÙ„Ø¨Ø§Ø± Ø§Ù„ØªØ§Ø¨Ø§Øª */
        .tabs-container { scrollbar-width: none; }
        .tabs-container::-webkit-scrollbar { display: none; }

        /* --- ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¯ÙØªØ± (Sepia - Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ ÙÙ‚Ø·) --- */
        html.light .notebook-page {
            background-color: var(--tw-color-sepia-bg);
            background-image: repeating-linear-gradient(to bottom, transparent, transparent 24px, var(--tw-color-sepia-lines) 25px);
            background-size: 100% 25px;
            border: 1px solid #d4b-a-8a;
            box-shadow: 2px 2px 10px rgba(0,0,0,0.1);
            color: var(--tw-color-sepia-text);
        }
        html.light .notebook-page .form-input,
        html.light .notebook-page textarea {
            background-color: rgba(255, 255, 255, 0.6);
            border-color: var(--tw-color-sepia-lines);
            color: var(--tw-color-sepia-text);
        }
        html.light .notebook-page .form-input:focus,
        html.light .notebook-page textarea:focus {
            background-color: rgba(255, 255, 255, 0.9);
        }
        html.light .notebook-page h2,
        html.light .notebook-page h3 {
            color: var(--tw-color-sepia-text);
            border-bottom-color: var(--tw-color-accent);
        }
        html.light .notebook-page table thead {
            background-color: rgba(255, 255, 255, 0.3);
        }
        html.light .notebook-page table,
        html.light .notebook-page table th,
        html.light .notebook-page table td {
            border-color: var(--tw-color-sepia-lines);
        }
        /* --- Ù†Ù‡Ø§ÙŠØ© ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¯ÙØªØ± --- */


        /* --- ØªØ£Ø«ÙŠØ± Ù‚Ù„Ø¨ Ø§Ù„ØµÙØ­Ø© (Page Flip) Ù„Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© --- */
        #main-book-container {
            position: relative;
            width: 100%;
            min-height: 700px;
            perspective: 2000px;
        }
        .book-page {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            transition: transform 0.9s ease-in-out;
            transform-origin: right center; /* (ØªØ¹Ø¯ÙŠÙ„) Ù„ÙŠÙ†Ø§Ø³Ø¨ RTL */
            backface-visibility: hidden;
            display: none; /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØµÙØ­Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠÙ‹Ø§ */
        }
        .book-page.active {
            display: block;
            transform: rotateY(0deg);
            z-index: 20;
        }
        .book-page.flipped {
            transform: rotateY(180deg); /* (ØªØ¹Ø¯ÙŠÙ„) Ù‚Ù„Ø¨ Ù„Ù„Ø®Ù„Ù */
            z-index: 10;
        }
        /* --- Ù†Ù‡Ø§ÙŠØ© ØªØ£Ø«ÙŠØ± Ù‚Ù„Ø¨ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ --- */

        /* --- ØªØ£Ø«ÙŠØ± Ù‚Ù„Ø¨ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ (Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©) --- */
        .inner-book-container {
            position: relative;
            width: 100%;
            min-height: 700px;
            perspective: 1500px;
        }
        .inner-book-page {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            transition: transform 0.8s ease-in-out;
            transform-origin: left center; /* Ø¯Ø§Ø®Ù„ÙŠ (LTR) */
            backface-visibility: hidden;
            display: none;
        }
        .inner-book-page.active { display: block; transform: rotateY(0deg); z-index: 20; }
        .inner-book-page.flipped { transform: rotateY(-180deg); z-index: 10; }
        /* --- Ù†Ù‡Ø§ÙŠØ© ØªØ£Ø«ÙŠØ± Ø§Ù„ØªÙ‚Ù„ÙŠØ¨ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ --- */


        .page-content-wrapper {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
        }
        .page-content-wrapper.front {
            transform: rotateY(0deg);
        }
        
        /* Ø±Ø³Ø§Ù„Ø© Ù…Ù†Ø¨Ø«Ù‚Ø© Ø¨Ø³ÙŠØ·Ø© (Toast) */
        #toast-notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            opacity: 0;
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
            z-index: 1000;
        }
        #toast-notification.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
        
        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
        @media (max-width: 768px) {
            .tab-btn {
                padding: 0.75rem 0.5rem;
                font-size: 0.875rem;
            }
            .header-title {
                font-size: 1.5rem;
            }
            #header-dates {
                font-size: 0.65rem;
            }
            .main-header .container {
                 padding-top: 0.5rem;
                 padding-bottom: 0.5rem;
            }
            nav.tabs-container {
                /* (ØªØ¹Ø¯ÙŠÙ„) ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ù€ top Ù„ÙŠÙ†Ø§Ø³Ø¨ Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¬Ø¯ÙŠØ¯ */
                top: 84px; 
            }
            /* (ØªØ¹Ø¯ÙŠÙ„) Ø¥Ø®ÙØ§Ø¡ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ÙÙŠ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ (Ù„Ø£Ù†Ù‡Ø§ ÙÙŠ Ø§Ù„Ù‡ÙŠØ¯Ø±) */
            #main-nav-controls {
                display: none; /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© */
            }
            #main-nav-controls-mobile {
                display: flex; /* Ø¥Ø¸Ù‡Ø§Ø± Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
                gap: 0.5rem;
            }
            #main-nav-controls-mobile button {
                padding: 0.25rem 0.5rem; /* ØªØµØºÙŠØ± Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
                font-size: 0.875rem;
            }
            #main-page-counter {
                font-size: 0.875rem;
                margin: 0 0.25rem;
            }

            main.container {
                padding: 0.75rem;
            }
            /* ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ù„Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù…ÙˆØ¯ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
            .manhaj-table table, 
            .manhaj-table thead, 
            .manhaj-table tbody, 
            .manhaj-table th, 
            .manhaj-table td, 
            .manhaj-table tr {
                display: block;
            }
            .manhaj-table thead tr {
                position: absolute;
                top: -9999px;
                left: -9999px;
            }
            .manhaj-table tr {
                border: 1px solid var(--tw-color-border-gray-700);
                margin-bottom: 0.5rem;
            }
            html.light .manhaj-table tr {
                border-color: var(--tw-color-border-gray-200);
            }
            .manhaj-table td {
                border: none;
                border-bottom: 1px solid #eee;
                position: relative;
                padding-left: 50% !important;
                padding-right: 0.5rem !important;
                text-align: left;
            }
            html.light .manhaj-table td {
                 border-bottom-color: var(--tw-color-sepia-lines);
            }
            .manhaj-table td:before {
                position: absolute;
                top: 6px;
                right: 6px; /* RTL */
                left: auto;
                width: 45%;
                padding-right: 10px;
                white-space: nowrap;
                font-weight: bold;
                text-align: right; /* RTL */
            }
            /* Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
            .manhaj-table td:nth-of-type(1):before { content: "Ø§Ù„Ø²Ù…Ù†"; }
            .manhaj-table td:nth-of-type(2):before { content: "Ø§Ù„Ù…Ù†Ù‡Ø¬"; }
            .manhaj-table td:nth-of-type(3):before { content: "Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹"; }
        }
        @media (max-width: 400px) {
             .tab-btn {
                font-size: 0.75rem;
             }
             #intro-page h1 { font-size: 2.5rem; }
             #intro-page p { font-size: 1.125rem; }
             #intro-page button { font-size: 1rem; padding: 0.75rem 2rem; }
        }
    </style>
</head>

<!-- Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† Ù‡Ùˆ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØŒ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ ÙŠØ¶Ø§Ù ÙƒÙƒÙ„Ø§Ø³ .light -->
<body class="bg-dark-bg text-dark-text transition-colors duration-300">

    <!-- ========== 0. ØµÙØ­Ø© Ø§Ù„Ø§Ù†ØªØ±Ùˆ ========== -->
    <div id="intro-page" class="fixed inset-0 z-[100] bg-dark-bg flex flex-col justify-center items-center text-center p-8 transition-opacity duration-1000">
        <h1 class="font-amiri text-5xl md:text-6xl font-bold text-white mb-6">ğŸ“š Ù…ÙƒØªØ¨ØªÙŠ ÙˆÙ…Ù†Ù‡Ø¬ÙŠ</h1>
        <p class="text-xl md:text-2xl text-gray-300 mb-12">Ø¯ÙØªØ±Ùƒ Ø§Ù„Ø´Ø®ØµÙŠ Ù„ØªÙ†Ø¸ÙŠÙ… Ø¹Ù„Ù…Ùƒ ÙˆØ­ÙŠØ§ØªÙƒ</p>
        <button id="start-journey-btn" class="bg-accent text-white px-10 py-4 rounded-lg font-semibold text-xl hover:opacity-90 transform hover:scale-105 transition-transform">
            Ø§Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙŠ
        </button>
    </div>

    <!-- ========== 1. Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ (Ø¨Ù†ÙŠ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„) ========== -->
    <header class="main-header sticky top-0 z-50 w-full bg-header-bg shadow-md">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            
            <!-- (ØªØ¹Ø¯ÙŠÙ„) Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† -->
            <div class="flex-shrink-0 flex flex-col items-start justify-center">
                <h1 class="header-title text-3xl font-amiri font-bold text-white">
                    ğŸ“š Ù…ÙƒØªØ¨ØªÙŠ ÙˆÙ…Ù†Ù‡Ø¬ÙŠ
                </h1>
                <div id="header-dates" class="text-xs text-gray-300 light:text-gray-400 mt-1">
                    <!-- Ø§Ù„ØªØ§Ø±ÙŠØ® ÙŠØ¶Ø§Ù Ù‡Ù†Ø§ Ø¹Ø¨Ø± JS -->
                </div>
            </div>

            <!-- (ØªØ¹Ø¯ÙŠÙ„) Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙˆØ§Ù„ØªÙ†Ù‚Ù„ Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø± -->
            <div class="flex-1 flex justify-end items-center gap-2 md:gap-4">
                
                <!-- (Ø¬Ø¯ÙŠØ¯) Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Ù„Ù„Ø¯Ø³ÙƒØªÙˆØ¨) -->
                <div id="main-nav-controls" class="hidden md:flex items-center gap-2">
                    <button id="main-prev-btn" class="bg-white text-header-bg px-4 py-1 rounded-lg font-semibold hover:opacity-90 disabled:opacity-50 text-sm">
                        &rarr; Ø§Ù„Ø³Ø§Ø¨Ù‚
                    </button>
                    <span id="main-page-counter" class="text-center text-gray-300 text-sm w-20"></span>
                    <button id="main-next-btn" class="bg-white text-header-bg px-4 py-1 rounded-lg font-semibold hover:opacity-90 disabled:opacity-50 text-sm">
                        Ø§Ù„ØªØ§Ù„ÙŠ &larr;
                    </button>
                </div>
                
                <!-- (Ø¬Ø¯ÙŠØ¯) Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„) -->
                <div id="main-nav-controls-mobile" class="md:hidden flex items-center gap-1">
                    <button id="main-prev-btn-mobile" class="bg-white text-header-bg px-2 py-1 rounded font-bold hover:opacity-90 disabled:opacity-50">
                        &rarr;
                    </button>
                    <span id="main-page-counter-mobile" class="text-center text-gray-300 text-xs w-12"></span>
                    <button id="main-next-btn-mobile" class="bg-white text-header-bg px-2 py-1 rounded font-bold hover:opacity-90 disabled:opacity-50">
                        &larr;
                    </button>
                </div>

                <!-- Ø²Ø± Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ -->
                <button id="darkModeToggle" class="text-white light:text-accent text-xl">
                    <span class="sun-icon">â˜€ï¸</span> <!-- ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† -->
                    <span class="moon-icon hidden">ğŸŒ™</span> <!-- ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ -->
                </button>
            </div>

        </div>
    </header>

    <!-- ========== 2. Ø´Ø±ÙŠØ· Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª (Tabs) ========== -->
    <nav class="tabs-container sticky top-[84px] md:top-[92px] z-40 bg-dark-card light:bg-white shadow-sm overflow-x-auto whitespace-nowrap">
        <div class="container mx-auto px-4 flex justify-center space-x-2 md:space-x-6 rtl:space-x-reverse">
            <!-- Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª ØªØªØ­ÙƒÙ… ÙÙŠ ØªÙ‚Ù„ÙŠØ¨ Ø§Ù„ØµÙØ­Ø§Øª -->
            <button class="tab-btn active py-3 px-1 text-sm md:text-lg md:px-2 border-b-4 border-transparent text-gray-400 light:text-gray-500 hover:text-accent" data-page-index="0">
                ğŸ™ï¸ Ø§Ù„ØªØ­Ø¶ÙŠØ±
            </button>
            <button class="tab-btn py-3 px-1 text-sm md:text-lg md:px-2 border-b-4 border-transparent text-gray-400 light:text-gray-500 hover:text-accent" data-page-index="1">
                 REVIEW
            </button>
            <button class="tab-btn py-3 px-1 text-sm md:text-lg md:px-2 border-b-4 border-transparent text-gray-400 light:text-gray-500 hover:text-accent" data-page-index="2">
                ğŸ“ Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©
            </button>
            <button class="tab-btn py-3 px-1 text-sm md:text-lg md:px-2 border-b-4 border-transparent text-gray-400 light:text-gray-500 hover:text-accent" data-page-index="3">
                ğŸ•Œ Ø§Ù„ØªØ±Ø§ÙˆÙŠØ­
            </button>
            <button class="tab-btn py-3 px-1 text-sm md:text-lg md:px-2 border-b-4 border-transparent text-gray-400 light:text-gray-500 hover:text-accent" data-page-index="4">
                ğŸ“… Ø§Ù„ØªØ®Ø·ÙŠØ·
            </button>
        </div>
    </nav>

    <!-- ========== 3. Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø¯ÙØªØ±) ========== -->
    <main class="container mx-auto p-4 md:p-6">

        <!-- Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø¯ÙØªØ± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
        <div id="main-book-container">

            <!-- ===== Ø§Ù„ØµÙØ­Ø© 1: Ù‚Ø³Ù… ØªØ­Ø¶ÙŠØ± Ø§Ù„ØªØ¬ÙˆÙŠØ¯ ===== -->
            <div id="tajweed" class="book-page page-content space-y-6" data-page-index="0">
                <div class="page-content-wrapper front">
                    <div id="tajweed-form-container" class="notebook-page p-6 bg-dark-card light:bg-white rounded-lg shadow-lg">
                        <div class="flex flex-wrap justify-between items-center mb-6">
                            <h2 class="font-amiri text-2xl font-bold text-accent light:text-primary-text border-b-2 border-accent pb-2">
                                ØªØ­Ø¶ÙŠØ± Ø­Ù„Ù‚Ø© Ø§Ù„ØªØ¬ÙˆÙŠØ¯
                            </h2>
                            <div class="flex gap-2 mt-2 md:mt-0">
                                <button id="save-prep-btn" class="bg-success text-black px-4 py-2 rounded-lg font-semibold hover:opacity-90">
                                    ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ­Ø¶ÙŠØ±
                                </button>
                                <button id="new-prep-btn" class="bg-warning text-black px-4 py-2 rounded-lg font-semibold hover:opacity-90">
                                    + ØªØ­Ø¶ÙŠØ± Ø¬Ø¯ÙŠØ¯
                                </button>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4 mb-6">
                            <div class="form-group"><label class="text-sm font-semibold">Ø±Ù‚Ù… Ø§Ù„Ø­Ù„Ù‚Ø©</label><input type="number" id="t-halaqaNum" class="form-input"></div>
                            <div class="form-group"><label class="text-sm font-semibold">Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</label><input type="text" id="t-groupName" class="form-input"></div>
                            <div class="form-group"><label class="text-sm font-semibold">Ø§Ù„ÙØ±Ù‚Ø©</label><input type="text" id="t-team" class="form-input"></div>
                            <div class="form-group"><label class="text-sm font-semibold">Ø§Ù„Ù…Ø³ØªÙˆÙ‰</label><input type="text" id="t-level" class="form-input"></div>
                            <div class="form-group"><label class="text-sm font-semibold">Ø§Ù„ØªØ§Ø±ÙŠØ®</label><input type="date" id="t-date" class="form-input"></div>
                            <div class="form-group col-span-1 md:col-span-2 lg:col-span-2"><label class="text-sm font-semibold">Ø§Ù„ÙØªØ±Ø©</label><div class="flex gap-2"><input type="time" id="t-timeFrom" class="form-input" title="Ù…Ù†"><input type="time" id="t-timeTo" class="form-input" title="Ø¥Ù„Ù‰"></div></div>
                        </div>

                        <!-- Ù…Ù†Ù‡Ø¬ Ø­Ù„Ù‚Ø© Ø§Ù„ÙŠÙˆÙ… -->
                        <h3 class="font-amiri text-xl font-bold text-gray-100 light:text-primary-text mb-4">Ù…Ù†Ù‡Ø¬ Ø­Ù„Ù‚Ø© Ø§Ù„ÙŠÙˆÙ…</h3>
                        <div class="manhaj-table overflow-x-auto rounded-lg border border-gray-700 light:border-gray-200">
                            <table class="min-w-full divide-y divide-gray-700 light:divide-gray-200">
                                <thead class="bg-gray-800 light:bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-3 text-right text-xs font-bold uppercase">Ø§Ù„Ø²Ù…Ù†</th>
                                        <th class="px-4 py-3 text-right text-xs font-bold uppercase">Ø§Ù„Ù…Ù†Ù‡Ø¬</th>
                                        <th class="px-4 py-3 text-right text-xs font-bold uppercase">Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ ÙˆØ§Ù„ØªÙØ§ØµÙŠÙ„</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-dark-card light:bg-white divide-y divide-gray-700 light:divide-gray-200">
                                     <tr>
                                        <td class="px-4 py-3 whitespace-nowrap">5 Ø¯Ù‚Ø§Ø¦Ù‚</td>
                                        <td class="px-4 py-3 font-semibold">ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø³Ø¨ÙˆØ±Ø© ÙˆØ§Ù„ØºÙŠØ§Ø¨</td>
                                        <td class="px-4 py-3"><input type="text" id="t-p1" class="form-input" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª..."></td>
                                    </tr>
                                    <tr>
                                        <td class="px-4 py-3 whitespace-nowrap">15 Ø¯Ù‚ÙŠÙ‚Ø©</td>
                                        <td class="px-4 py-3 font-semibold">Ø§Ù„Ø£Ø­ÙƒØ§Ù…</td>
                                        <td class="px-4 py-3"><textarea id="t-p2" class="form-input" rows="2" placeholder="Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¯Ø±Ø³..."></textarea></td>
                                    </tr>
                                    <tr>
                                        <td class="px-4 py-3 whitespace-nowrap">50 Ø¯Ù‚ÙŠÙ‚Ø©</td>
                                        <td class="px-4 py-3 font-semibold">Ø§Ù„ØªØ³Ù…ÙŠØ¹ ÙˆØ§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</td>
                                        <td class="px-4 py-3"><textarea id="t-p3" class="form-input" rows="2" placeholder="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©..."></textarea></td>
                                    </tr>
                                    <tr>
                                        <td class="px-4 py-3 whitespace-nowrap">50 Ø¯Ù‚ÙŠÙ‚Ø©</td>
                                        <td class="px-4 py-3 font-semibold">Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ø¬Ø¯ÙŠØ¯</td>
                                        <td class="px-4 py-3 space-y-2">
                                            <div class="flex flex-col md:flex-row gap-2">
                                                <input type="number" id="surah-number-input" class="form-input md:w-1/2" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø³ÙˆØ±Ø© (Ù…Ø«Ø§Ù„: 1)">
                                                <input type="number" id="t-hifzPage" class="form-input md:w-1/2" placeholder="Ø±Ù‚Ù… Ø§Ù„ØµÙØ­Ø©">
                                            </div>
                                            <div class="flex flex-col md:flex-row gap-2">
                                                <input type="number" id="t-hifzAyahFrom" class="form-input md:w-1/2" placeholder="Ù…Ù† Ø¢ÙŠØ©">
                                                <input type="number" id="t-hifzAyahTo" class="form-input md:w-1/2" placeholder="Ø¥Ù„Ù‰ Ø¢ÙŠØ©">
                                            </div>
                                            <div class="relative">
                                                <button id="fetch-meanings-btn" class="absolute top-2 left-2 text-xs bg-accent text-white px-2 py-1 rounded hover:opacity-90 z-10">
                                                    Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø¹Ø§Ù†ÙŠ
                                                </button>
                                                <textarea id="word-meanings-output" class="form-input" rows="4" placeholder="Ø§Ù„Ù…Ø¹Ø§Ù†ÙŠ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ© (Ø§Ù„ØªÙØ³ÙŠØ± Ø§Ù„Ù…ÙŠØ³Ø±)..."></textarea>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Ù…Ù†Ù‡Ø¬ Ø§Ù„Ø­Ù„Ù‚Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© -->
                        <h3 class="font-amiri text-xl font-bold text-gray-100 light:text-primary-text mt-6 mb-4">Ù…Ù†Ù‡Ø¬ Ø§Ù„Ø­Ù„Ù‚Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <input type="text" id="t-nextSurah" class="form-input" placeholder="Ø§Ù„Ø³ÙˆØ±Ø©">
                            <input type="text" id="t-nextAyahs" class="form-input" placeholder="Ø§Ù„Ø¢ÙŠØ§Øª Ù…Ù† .. Ø¥Ù„Ù‰ ..">
                            <input type="text" id="t-nextReview" class="form-input" placeholder="Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©">
                            <input type="text" id="t-nextAhkam" class="form-input" placeholder="Ø§Ù„Ø£Ø­ÙƒØ§Ù…">
                        </div>

                        <!-- ØªÙˆØµÙŠØ§Øª Ø§Ù„Ù…Ø´Ø±Ù -->
                        <h3 class="font-amiri text-xl font-bold text-gray-100 light:text-primary-text mt-6 mb-4">ØªÙˆØµÙŠØ§Øª Ø§Ù„Ù…Ø´Ø±Ù</h3>
                        <textarea id="t-supervisorNotes" class="form-input bg-gray-800 light:bg-gray-100" rows="3" placeholder="ØªØ¸Ù‡Ø± Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø´Ø±Ù Ù‡Ù†Ø§..." readonly></textarea>
                        <div class="flex flex-col md:flex-row justify-between items-center mt-4">
                            <div class="border-t-2 border-dashed border-gray-600 w-1/3 pt-1 text-sm text-gray-500 text-center md:text-right">ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…Ø´Ø±Ù</div>
                            <button id="share-whatsapp-btn" class="mt-4 md:mt-0 bg-green-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-green-600 w-full md:w-auto">
                                Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„ØªØ­Ø¶ÙŠØ± (ØµÙˆØ±Ø©)
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ===== Ø§Ù„ØµÙØ­Ø© 2: Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù…Ø´Ø±Ù ===== -->
            <div id="supervisor" class="book-page page-content space-y-6" data-page-index="1">
                 <div class="page-content-wrapper front">
                    <div class="p-6 bg-dark-card light:bg-white rounded-lg shadow-lg h-full">
                        <h2 class="font-amiri text-2xl font-bold text-accent light:text-primary-text mb-6">
                            Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØªØ­Ø¶ÙŠØ±Ø§Øª (ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø´Ø±Ù)
                        </h2>
                        <!-- (ØªØ¹Ø¯ÙŠÙ„) Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙƒÙ„Ø§Ø³ Ø§Ù„ØªÙ‚Ù„ÙŠØ¨ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ -->
                        <div id="supervisor-book-container" class="inner-book-container">
                            <!-- Ø§Ù„ØµÙØ­Ø§Øª ØªØ¶Ø§Ù Ù‡Ù†Ø§ Ø¹Ø¨Ø± JS -->
                        </div>
                        <div class="flex justify-center gap-4 mt-6">
                            <button id="prev-page-btn-inner" class="bg-accent text-white px-6 py-2 rounded-lg font-semibold hover:opacity-90 disabled:opacity-50" disabled>
                                &rarr; Ø§Ù„Ø³Ø§Ø¨Ù‚
                            </button>
                            <button id="next-page-btn-inner" class="bg-accent text-white px-6 py-2 rounded-lg font-semibold hover:opacity-90 disabled:opacity-50" disabled>
                                Ø§Ù„ØªØ§Ù„ÙŠ &larr;
                            </button>
                        </div>
                        <div id="page-counter-inner" class="text-center text-gray-400 light:text-gray-500"></div>
                    </div>
                </div>
            </div>


            <!-- ===== Ø§Ù„ØµÙØ­Ø© 3: Ù‚Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠ ===== -->
            <div id="university" class="book-page page-content space-y-6" data-page-index="2">
                 <div class="page-content-wrapper front">
                    <div class="p-6 bg-dark-card light:bg-white rounded-lg shadow-lg h-full">
                        <div class="flex flex-col md:flex-row justify-between items-center">
                            <h2 class="font-amiri text-2xl font-bold text-accent light:text-primary-text mb-4 md:mb-0">
                                Ù…ÙˆØ§Ø¯ÙŠ Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠØ©
                            </h2>
                            <button id="add-subject-btn" class="bg-accent text-white px-4 py-2 rounded-lg font-semibold hover:opacity-90 w-full md:w-auto">
                                + Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø©
                            </button>
                        </div>
                        <div id="subjects-container" class="mt-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ù…ÙˆØ§Ø¯ Ù‡Ù†Ø§ -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- ===== Ø§Ù„ØµÙØ­Ø© 4: Ù‚Ø³Ù… ØµÙ„Ø§Ø© Ø§Ù„ØªØ±Ø§ÙˆÙŠØ­ ===== -->
            <div id="tarawih" class="book-page page-content" data-page-index="3">
                 <div class="page-content-wrapper front">
                    <div class="p-6 bg-dark-card light:bg-white rounded-lg shadow-lg h-full">
                        <h2 class="font-amiri text-2xl font-bold text-accent light:text-primary-text mb-6">
                            Ø¬Ø¯ÙˆÙ„ ØµÙ„Ø§Ø© Ø§Ù„ØªØ±Ø§ÙˆÙŠØ­
                        </h2>
                        <div id="tarawih-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ø£ÙŠØ§Ù… Ù‡Ù†Ø§ -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- ===== Ø§Ù„ØµÙØ­Ø© 5: Ù‚Ø³Ù… Ø§Ù„ØªØ®Ø·ÙŠØ· Ø§Ù„ÙŠÙˆÙ…ÙŠ ===== -->
            <div id="planning" class="book-page page-content" data-page-index="4">
                 <div class="page-content-wrapper front">
                    <div class="p-6 bg-dark-card light:bg-white rounded-lg shadow-lg h-full">
                        <h2 class="font-amiri text-2xl font-bold text-accent light:text-primary-text text-center mb-4">
                            Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø£ÙˆÙ„ (Ø§Ù„ØªØ§Ø±ÙŠØ®...)
                        </h2>
                        <div id="planning-week" class="space-y-6">
                            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ø£ÙŠØ§Ù… Ù‡Ù†Ø§ -->
                        </div>
                    </div>
                </div>
            </div>
            
        </div> <!-- Ù†Ù‡Ø§ÙŠØ© #main-book-container -->

        <!-- (ØªØ¹Ø¯ÙŠÙ„) ØªÙ… Ù†Ù‚Ù„ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø¥Ù„Ù‰ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ -->

    </main>

    <!-- ========== 4. Ø§Ù„Ø¹Ø§Ø±Ø¶ Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚ (Modal) Ù„Ù„Ø¬Ø§Ù…Ø¹Ø© ========== -->
    <div id="viewer-modal" class="fixed inset-0 z-[100] bg-black bg-opacity-70 flex justify-center items-center p-4 hidden transition-opacity duration-300">
        <div class="bg-dark-card light:bg-white w-full max-w-4xl h-[90vh] rounded-lg shadow-2xl flex flex-col">
            <div class="flex justify-between items-center p-4 border-b border-gray-700 light:border-gray-200">
                <h3 id="modal-title" class="font-amiri text-xl font-bold text-accent light:text-primary-text"></h3>
                <button id="close-modal-btn" class="text-3xl text-gray-400 hover:text-red-500">&times;</button>
            </div>
            <div class="flex-1 flex flex-col md:flex-row overflow-hidden">
                <div id="viewer-content" class="flex-1 bg-dark-bg light:bg-gray-100 flex justify-center items-center">
                    <p class="text-gray-400">Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù‡Ù†Ø§...</p>
                </div>
                <div class="w-full md:w-1/3 p-4 border-t md:border-t-0 md:border-r border-gray-700 light:border-gray-200 flex flex-col">
                    <h4 class="font-amiri font-bold text-lg mb-2">Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø°Ø§ÙƒØ±Ø©</h4>
                    <div class="space-x-2 rtl:space-x-reverse mb-4">
                        <button class="tool-btn px-3 py-1 rounded bg-yellow-300 text-black text-sm">ğŸ–‹ï¸ Ù‚Ù„Ù…</button>
                        <button class="tool-btn px-3 py-1 rounded bg-green-300 text-black text-sm"> highlighter</button>
                    </div>
                    <label for="study-notes" class="text-sm font-semibold mb-2">Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙŠ:</label>
                    <textarea id="study-notes" class="form-input flex-1" rows="10" placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù..."></textarea>
                </div>
            </div>
        </div>
    </div>

    <!-- ========== 5. Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ (Toast) ========== -->
    <div id="toast-notification" class="p-3 rounded-lg shadow-lg bg-success text-black font-semibold">
        <span id="toast-message"></span>
    </div>


    <!-- ========== 6. JavaScript (Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¨Ø±Ø¬ÙŠ) ========== -->
    <script>
        // --- 1. Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© ---
        
        function applyInputStyles() {
            document.querySelectorAll('.form-input').forEach(input => {
                if(input.classList.contains('form-input-styled')) return;
                input.classList.add(
                    'form-input-styled', 'w-full', 'mt-1', 'p-2', 'border', 'rounded-md',
                    'bg-gray-700', 'border-gray-600', 'text-white',
                    'light:bg-gray-100', 'light:border-gray-300', 'light:text-black',
                    'focus:ring-2', 'focus:ring-accent', 'focus:outline-none', 'transition-colors'
                );
            });
        }
        
        const APP_DATA_KEY = 'myManhajData_v2';
        const getDefaultData = () => ({
            tajweed: { preparations: [], currentPrepId: null },
            university: { subjects: [] },
            tarawih: {},
            planning: {}
        });
        let appData = getDefaultData();

        // --- 2. Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ---
        function saveAppData() {
            localStorage.setItem(APP_DATA_KEY, JSON.stringify(appData));
            console.log("Data Saved:", appData);
        }

        function loadAppData() {
            const savedData = localStorage.getItem(APP_DATA_KEY);
            if (savedData) {
                appData = JSON.parse(savedData);
                appData.tajweed = appData.tajweed || getDefaultData().tajweed;
                appData.university = appData.university || getDefaultData().university;
                appData.tarawih = appData.tarawih || getDefaultData().tarawih;
                appData.planning = appData.planning || getDefaultData().planning;
            } else {
                appData = getDefaultData();
            }
            console.log("Data Loaded:", appData);
        }

        // --- 3. Ø¯ÙˆØ§Ù„ Ø®Ø§ØµØ© Ø¨Ù‚Ø³Ù… Ø§Ù„ØªØ¬ÙˆÙŠØ¯ ---
        
        const tajweedFieldIds = [
            't-halaqaNum', 't-groupName', 't-team', 't-level', 't-date', 't-timeFrom', 't-timeTo',
            't-p1', 't-p2', 't-p3',
            'surah-number-input', 't-hifzPage', 't-hifzAyahFrom', 't-hifzAyahTo', 'word-meanings-output',
            't-nextSurah', 't-nextAyahs', 't-nextReview', 't-nextAhkam', 't-supervisorNotes'
        ];

        function loadPreparation(prepId) {
            let prep = null;
            if (prepId) {
                prep = appData.tajweed.preparations.find(p => p.id === prepId);
            }

            if (prep) {
                tajweedFieldIds.forEach(id => {
                    const el = document.getElementById(id);
                    if (el) { el.value = prep[id] || ''; }
                });
                appData.tajweed.currentPrepId = prepId;
            } else {
                tajweedFieldIds.forEach(id => {
                    const el = document.getElementById(id);
                    if(el) el.value = '';
                });
                appData.tajweed.currentPrepId = null;
                document.getElementById('t-date').valueAsDate = new Date();
            }
        }

        function saveCurrentPreparation() {
            let currentId = appData.tajweed.currentPrepId;
            let prep = null;

            if (currentId) {
                prep = appData.tajweed.preparations.find(p => p.id === currentId);
            }

            if (!prep) {
                prep = { id: Date.now() };
                appData.tajweed.preparations.push(prep);
                appData.tajweed.currentPrepId = prep.id;
            }

            tajweedFieldIds.forEach(id => {
                const el = document.getElementById(id);
                if (el) { prep[id] = el.value; }
            });

            saveAppData();
            showToast('ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ­Ø¶ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­!', 'success');
            renderSupervisorPage();
        }

        async function fetchMeanings() {
            const surahNum = document.getElementById('surah-number-input').value;
            const ayahFrom = document.getElementById('t-hifzAyahFrom').value;
            const ayahTo = document.getElementById('t-hifzAyahTo').value;
            const outputEl = document.getElementById('word-meanings-output');

            if (!surahNum || !ayahFrom || !ayahTo) {
                outputEl.value = "ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø³ÙˆØ±Ø© ÙˆØ¨Ø¯Ø§ÙŠØ© ÙˆÙ†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¢ÙŠØ§Øª.";
                return;
            }
            
            outputEl.value = "Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„ØªÙØ³ÙŠØ± Ø§Ù„Ù…ÙŠØ³Ø±...";
            
            let allTafseers = [];
            const tafseerId = 16; 

            try {
                for (let i = parseInt(ayahFrom); i <= parseInt(ayahTo); i++) {
                    const url = `https://api.quran.com/api/v4/tafsirs/${tafseerId}/by_ayah/${surahNum}:${i}`;
                    const response = await fetch(url);
                    if (!response.ok) {
                        throw new Error(`Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¢ÙŠØ© ${i}`);
                    }
                    const data = await response.json();
                    
                    if (data.tafsir.text) {
                        const text = data.tafsir.text.replace(/<[^>]*>/g, '');
                        allTafseers.push(`Ø¢ÙŠØ© (${i}): ${text}`);
                    }
                }
                
                if (allTafseers.length > 0) {
                    outputEl.value = allTafseers.join('\n\n');
                } else {
                    outputEl.value = "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØªÙØ³ÙŠØ± Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø¢ÙŠØ§Øª.";
                }
                
            } catch (error) {
                console.error("Error fetching tafseer:", error);
                outputEl.value = `Ø­Ø¯Ø« Ø®Ø·Ø£: ${error.message}\nØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø±Ù‚Ù… Ø§Ù„Ø³ÙˆØ±Ø© ÙˆØ§Ù„Ø¢ÙŠØ§Øª.`;
            }
            
            saveCurrentPreparation();
        }

        // --- 4. Ø¯ÙˆØ§Ù„ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø´Ø±Ù (Ø§Ù„ØªÙ‚Ù„ÙŠØ¨ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ) ---
        const innerBookContainer = document.getElementById('supervisor-book-container');
        const innerPrevBtn = document.getElementById('prev-page-btn-inner');
        const innerNextBtn = document.getElementById('next-page-btn-inner');
        const innerPageCounter = document.getElementById('page-counter-inner');
        let innerCurrentPageIndex = 0;

        function renderSupervisorPage() {
            innerBookContainer.innerHTML = '';
            const preps = appData.tajweed.preparations;

            if (preps.length === 0) {
                innerBookContainer.innerHTML = `<p class="text-center text-gray-400 light:text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ­Ø¶ÙŠØ±Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ù„Ø¹Ø±Ø¶Ù‡Ø§.</p>`;
                innerPageCounter.textContent = '';
                innerPrevBtn.style.display = 'none';
                innerNextBtn.style.display = 'none';
                return;
            }

            innerPrevBtn.style.display = 'block';
            innerNextBtn.style.display = 'block';

            preps.forEach((prep, index) => {
                const pageEl = document.createElement('div');
                pageEl.className = 'inner-book-page'; // (ØªØ¹Ø¯ÙŠÙ„) ÙƒÙ„Ø§Ø³ Ø§Ù„ØªÙ‚Ù„ÙŠØ¨ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ
                if (index === innerCurrentPageIndex) pageEl.classList.add('active');
                if (index < innerCurrentPageIndex) pageEl.classList.add('flipped');
                pageEl.dataset.index = index;
                
                pageEl.innerHTML = `
                    <div class="page-content-wrapper front">
                        <div class="notebook-page p-6 bg-dark-card light:bg-white rounded-lg shadow-lg h-full overflow-auto">
                            <h3 class="font-amiri text-xl font-bold">Ù…Ø±Ø§Ø¬Ø¹Ø©: ${prep['t-groupName'] || 'ØªØ­Ø¶ÙŠØ±'}</h3>
                            <p class="text-sm text-gray-500 mb-4">Ø§Ù„ØªØ§Ø±ÙŠØ®: ${prep['t-date'] || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                            
                            <div class="mb-4">
                                <strong class="text-accent light:text-primary-text">Ø§Ù„Ø­ÙØ¸:</strong>
                                <span>${prep['surah-number-input'] || '?'} (Ø¢ÙŠØ© ${prep['t-hifzAyahFrom'] || '?'} Ø¥Ù„Ù‰ ${prep['t-hifzAyahTo'] || '?'})</span>
                            </div>
                            <div class="mb-4">
                                <strong class="text-accent light:text-primary-text">Ø§Ù„Ø£Ø­ÙƒØ§Ù…:</strong>
                                <p class="text-sm p-2 bg-gray-800 light:bg-gray-100 rounded">${prep['t-p2'] || '...'}</p>
                            </div>
                            
                            <h4 class="font-amiri text-lg font-bold mt-6 mb-2">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø´Ø±Ù (ØªÙØ§Ø¹Ù„ÙŠ)</h4>
                            <textarea class="supervisor-note-input form-input" data-prep-id="${prep.id}" rows="4" placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ù‡Ù†Ø§...">${prep['t-supervisorNotes'] || ''}</textarea>
                        </div>
                    </div>
                `;
                innerBookContainer.appendChild(pageEl);
            });

            applyInputStyles();
            updateInnerPageFlip();
        }

        function updateInnerPageFlip() {
            const pages = innerBookContainer.querySelectorAll('.inner-book-page');
            pages.forEach((page, index) => {
                page.classList.remove('active', 'flipped');
                if (index < innerCurrentPageIndex) {
                    page.classList.add('flipped');
                } else if (index === innerCurrentPageIndex) {
                    page.classList.add('active');
                }
            });
            innerPageCounter.textContent = `ØµÙØ­Ø© ${innerCurrentPageIndex + 1} Ù…Ù† ${appData.tajweed.preparations.length}`;
            innerPrevBtn.disabled = innerCurrentPageIndex === 0;
            innerNextBtn.disabled = innerCurrentPageIndex === appData.tajweed.preparations.length - 1;
        }

        // --- 5. Ø¯ÙˆØ§Ù„ Ù‚Ø³Ù… Ø§Ù„Ø¬Ø§Ù…Ø¹Ø© (File Upload) ---
        const subjectsContainer = document.getElementById('subjects-container');

        function renderUniversitySubjects() {
            subjectsContainer.innerHTML = '';
            if (appData.university.subjects.length === 0) {
                subjectsContainer.innerHTML = `<p class="text-gray-400 light:text-gray-500 col-span-full text-center">Ù„Ù… ØªÙ‚Ù… Ø¨Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ§Ø¯ Ø¨Ø¹Ø¯.</p>`;
            }
            
            appData.university.subjects.forEach(subject => {
                const card = document.createElement('div');
                card.className = 'p-4 bg-dark-card light:bg-white rounded-lg shadow-md flex flex-col';
                
                let filesHTML = '<p class="text-sm text-gray-400 light:text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª Ø¨Ø¹Ø¯.</p>';
                if (subject.files && subject.files.length > 0) {
                    filesHTML = subject.files.map(file => `
                        <div class="flex justify-between items-center p-2 bg-gray-700 light:bg-gray-50 rounded cursor-pointer open-viewer-btn" data-subject-id="${subject.id}" data-file-id="${file.id}">
                            <span>${file.type.startsWith('audio') ? 'ğŸ§' : 'ğŸ“„'} ${file.name}</span>
                            <button class="text-sm text-blue-500 hover:text-blue-700">ÙØªØ­</button>
                        </div>
                    `).join('');
                }

                card.innerHTML = `
                    <h3 class="font-amiri text-xl font-bold text-accent light:text-primary-text mb-3">${subject.name}</h3>
                    <div class="file-list space-y-2 mb-3 flex-1">
                        ${filesHTML}
                    </div>
                    <div class="flex gap-2">
                        <input type="file" class="hidden file-input-pdf" accept="application/pdf" data-subject-id="${subject.id}">
                        <button class="add-pdf-btn flex-1 bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600">Ø¥Ø¶Ø§ÙØ© PDF</button>
                        
                        <input type="file" class="hidden file-input-audio" accept="audio/*" data-subject-id="${subject.id}">
                        <button class="add-audio-btn flex-1 bg-purple-500 text-white px-3 py-1 rounded text-sm hover:bg-purple-600">Ø¥Ø¶Ø§ÙØ© ØµÙˆØªÙŠ</button>
                    </div>
                `;
                subjectsContainer.appendChild(card);
            });
        }
        
        function handleFileUpload(e) {
            const file = e.target.files[0];
            const subjectId = parseInt(e.target.dataset.subjectId);
            if (!file || !subjectId) return;

            const reader = new FileReader();
            reader.onload = (event) => {
                const dataUrl = event.target.result;
                const fileData = { id: Date.now(), name: file.name, type: file.type, dataUrl: dataUrl };
                const subject = appData.university.subjects.find(s => s.id === subjectId);
                if (subject) {
                    if (!subject.files) subject.files = [];
                    subject.files.push(fileData);
                    saveAppData();
                    renderUniversitySubjects();
                    showToast('ØªÙ… Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                }
            };
            reader.onerror = () => showToast('ÙØ´Ù„ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù', 'error');
            reader.readAsDataURL(file);
        }

        // --- 6. Ø¯ÙˆØ§Ù„ Ù‚Ø³Ù… Ø§Ù„ØªØ±Ø§ÙˆÙŠØ­ ---
        const tarawihGrid = document.getElementById('tarawih-grid');

        function renderTarawihGrid() {
            tarawihGrid.innerHTML = '';
            for (let i = 1; i <= 30; i++) {
                const isLastTen = i > 20;
                const dayData = appData.tarawih[i] || {};
                
                const dayCard = document.createElement('div');
                dayCard.className = 'p-4 bg-gray-800 light:bg-gray-50 rounded-lg border border-gray-700 light:border-gray-200';
                dayCard.innerHTML = `
                    <h4 class="font-amiri font-bold text-lg text-accent light:text-primary-text mb-2">Ø§Ù„ÙŠÙˆÙ… ${i}</h4>
                    <div class="space-y-2">
                        <input type="text" value="${dayData.mosque || ''}" class="form-input tarawih-input" data-day="${i}" data-key="mosque" placeholder="Ø§Ù„Ù…Ø³Ø¬Ø¯ (Ø§Ù„ØªØ±Ø§ÙˆÙŠØ­)">
                        <input type="date" value="${dayData.date || ''}" class="form-input tarawih-input" data-day="${i}" data-key="date">
                        ${isLastTen ? `
                        <div class="mt-3 pt-3 border-t border-dashed border-accent">
                            <h5 class="text-sm font-semibold text-accent mb-1">ØµÙ„Ø§Ø© Ø§Ù„ØªÙ‡Ø¬Ø¯</h5>
                            <input type="text" value="${dayData.tahajjud || ''}" class="form-input tarawih-input" data-day="${i}" data-key="tahajjud" placeholder="Ø§Ù„Ù…Ø³Ø¬Ø¯ (Ø§Ù„ØªÙ‡Ø¬Ø¯)">
                        </div>
                        ` : ''}
                    </div>
                `;
                tarawihGrid.appendChild(dayCard);
            }
            applyInputStyles();
        }

        // --- 7. Ø¯ÙˆØ§Ù„ Ù‚Ø³Ù… Ø§Ù„ØªØ®Ø·ÙŠØ· ---
        const planningWeek = document.getElementById('planning-week');
        const daysOfWeek = ['Ø§Ù„Ø³Ø¨Øª', 'Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©'];

        function renderPlanningWeek() {
            planningWeek.innerHTML = '';
            daysOfWeek.forEach(day => {
                if (!appData.planning[day]) appData.planning[day] = { tasks: [] };
                while (appData.planning[day].tasks.length < 5) {
                    appData.planning[day].tasks.push({ text: '', done: false });
                }

                const tasksHTML = appData.planning[day].tasks.map((task, index) => 
                    addTaskElement(day, index, task)
                ).join('');

                const dayCard = document.createElement('div');
                dayCard.className = 'p-4 bg-gray-800 light:bg-gray-50 rounded-lg';
                dayCard.innerHTML = `
                    <h3 class="font-amiri text-xl font-bold text-accent light:text-primary-text mb-3">${day}</h3>
                    <div class="task-list space-y-2" data-day="${day}">
                        ${tasksHTML}
                    </div>
                    <div class="flex gap-2 mt-3">
                        <input type="text" class="form-input new-task-input" placeholder="Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©...">
                        <button class="add-task-btn bg-accent text-white px-3 py-1 rounded hover:opacity-90" data-day="${day}">Ø¥Ø¶Ø§ÙØ©</button>
                    </div>
                `;
                planningWeek.appendChild(dayCard);
            });
            applyInputStyles();
        }
        
        function addTaskElement(day, index, task) {
            return `
                <div class="flex items-center gap-2">
                    <input type="checkbox" ${task.done ? 'checked' : ''} class="h-5 w-5 rounded text-accent focus:ring-accent planning-task-check" data-day="${day}" data-index="${index}">
                    <input type="text" value="${task.text || ''}" class="form-input task-text ${task.done ? 'line-through' : ''} planning-task-text" data-day="${day}" data-index="${index}" placeholder="Ù…Ù‡Ù…Ø©...">
                </div>
            `;
        }

        // --- 8. Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© (Ø§Ù„ØªØ§Ø±ÙŠØ®ØŒ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§ØªØŒ Ø§Ù„Ø¹Ø§Ø±Ø¶) ---

        function setHeaderDates() {
            try {
                const today = new Date();
                const gregorian = new Intl.DateTimeFormat('ar-EG', { dateStyle: 'long' }).format(today);
                const hijri = new Intl.DateTimeFormat('ar-EG-u-ca-islamic', { dateStyle: 'long', timeZone: 'Africa/Cairo' }).format(today);
                document.getElementById('header-dates').textContent = `${gregorian} | ${hijri}`;
            } catch (e) {
                const gregorian = new Date().toLocaleDateString('ar-EG', { dateStyle: 'long' });
                document.getElementById('header-dates').textContent = gregorian;
            }
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast-notification');
            const toastMessage = document.getElementById('toast-message');
            toastMessage.textContent = message;
            toast.className = 'p-3 rounded-lg shadow-lg text-black font-semibold';
            if (type === 'success') toast.classList.add('bg-success');
            else if (type === 'error') toast.classList.add('bg-red-500');
            else toast.classList.add('bg-warning');
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }
        
        const modal = document.getElementById('viewer-modal');
        const modalTitle = document.getElementById('modal-title');
        const viewerContent = document.getElementById('viewer-content');

        function openViewer(file) {
            modalTitle.textContent = file.name;
            viewerContent.innerHTML = '';
            if (file.type.startsWith('application/pdf')) {
                viewerContent.innerHTML = `<iframe src="${file.dataUrl}" class="w-full h-full" title="Ø¹Ø§Ø±Ø¶ PDF"></iframe>`;
            } else if (file.type.startsWith('audio/')) {
                viewerContent.innerHTML = `<audio controls src="${file.dataUrl}" class="w-full max-w-md my-auto"></audio>`;
            }
            modal.classList.remove('hidden');
        }

        // --- (ØªØ¹Ø¯ÙŠÙ„) 9. Ø¯ÙˆØ§Ù„ ØªÙ‚Ù„ÙŠØ¨ Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ---
        const mainBookContainer = document.getElementById('main-book-container');
        const mainPages = document.querySelectorAll('.book-page');
        
        // (ØªØ¹Ø¯ÙŠÙ„) ØªØ¹Ø±ÙŠÙ Ø¬Ù…ÙŠØ¹ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„ (Ù„Ù„Ø¯Ø³ÙƒØªÙˆØ¨ ÙˆØ§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„)
        const navControls = {
            prevBtns: [document.getElementById('main-prev-btn'), document.getElementById('main-prev-btn-mobile')],
            nextBtns: [document.getElementById('main-next-btn'), document.getElementById('main-next-btn-mobile')],
            counters: [document.getElementById('main-page-counter'), document.getElementById('main-page-counter-mobile')]
        };
        
        const tabButtons = document.querySelectorAll('.tab-btn');
        let mainCurrentPageIndex = 0;

        function updateMainPageFlip() {
            mainPages.forEach((page, index) => {
                page.classList.remove('active', 'flipped');
                if (index < mainCurrentPageIndex) {
                    page.classList.add('flipped');
                } else if (index === mainCurrentPageIndex) {
                    page.classList.add('active');
                }
            });
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ§Ø¨ Ø§Ù„Ù†Ø´Ø·
            tabButtons.forEach(btn => {
                btn.classList.toggle('active', parseInt(btn.dataset.pageIndex) === mainCurrentPageIndex);
            });

            // (ØªØ¹Ø¯ÙŠÙ„) ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ø£Ø²Ø±Ø§Ø±
            const pageText = `ØµÙØ­Ø© ${mainCurrentPageIndex + 1}/${mainPages.length}`;
            navControls.counters.forEach(counter => counter.textContent = pageText);
            navControls.prevBtns.forEach(btn => btn.disabled = mainCurrentPageIndex === 0);
            navControls.nextBtns.forEach(btn => btn.disabled = mainCurrentPageIndex === mainPages.length - 1);

            // Ø¥Ø·Ù„Ø§Ù‚ Ø¨Ù†Ø§Ø¡ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø§Øª Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø© (Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ù…Ù„ Ø§Ù„Ø­ÙØ¸ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ)
            if (mainCurrentPageIndex === 0) loadPreparation(appData.tajweed.currentPrepId);
            if (mainCurrentPageIndex === 1) { innerCurrentPageIndex = 0; renderSupervisorPage(); }
            if (mainCurrentPageIndex === 2) renderUniversitySubjects();
            if (mainCurrentPageIndex === 3) renderTarawihGrid();
            if (mainCurrentPageIndex === 4) renderPlanningWeek();
        }

        function goToPage(index) {
            mainCurrentPageIndex = index;
            updateMainPageFlip();
        }

        // --- 10. Ù…Ø´ØºÙ„Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Event Listeners) ---
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- 1. Ù…Ù†Ø·Ù‚ ØµÙØ­Ø© Ø§Ù„Ø§Ù†ØªØ±Ùˆ ---
            const introPage = document.getElementById('intro-page');
            const startBtn = document.getElementById('start-journey-btn');
            
            if (localStorage.getItem('visited') === 'true') {
                introPage.style.display = 'none';
            }

            startBtn.addEventListener('click', () => {
                introPage.style.opacity = '0';
                setTimeout(() => {
                    introPage.style.display = 'none';
                }, 1000); 
                localStorage.setItem('visited', 'true');
            });
            
            // --- 2. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ---
            loadAppData();
            
            // (ØªØ¹Ø¯ÙŠÙ„) Ø¥Ø·Ù„Ø§Ù‚ Ø£ÙˆÙ„ ØµÙØ­Ø© ÙÙ‚Ø·
            goToPage(0);
            applyInputStyles();
            
            // --- 3. Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†/Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ ---
            const darkModeToggle = document.getElementById('darkModeToggle');
            const sunIcons = document.querySelectorAll('.sun-icon');
            const moonIcons = document.querySelectorAll('.moon-icon');

            const updateIcons = (isLight) => {
                sunIcons.forEach(icon => icon.style.display = isLight ? 'none' : 'inline'); 
                moonIcons.forEach(icon => icon.style.display = isLight ? 'inline' : 'none');
            };

            const setMode = (isLight) => {
                document.documentElement.classList.toggle('light', isLight);
                localStorage.setItem('theme', isLight ? 'light' : 'dark');
                updateIcons(isLight);
            };

            darkModeToggle.addEventListener('click', () => setMode(!document.documentElement.classList.contains('light')));
            setMode(localStorage.getItem('theme') === 'light');
            setHeaderDates();

            // --- 4. Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª (Tabs) Ù„Ù„ØªÙ‚Ù„ÙŠØ¨ ---
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    goToPage(parseInt(button.dataset.pageIndex));
                });
            });

            // --- 5. Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ‚Ù„ÙŠØ¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Ù„Ù„Ø¯Ø³ÙƒØªÙˆØ¨ ÙˆØ§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„) ---
            navControls.prevBtns.forEach(btn => btn.addEventListener('click', () => { if (mainCurrentPageIndex > 0) goToPage(mainCurrentPageIndex - 1); }));
            navControls.nextBtns.forEach(btn => btn.addEventListener('click', () => { if (mainCurrentPageIndex < mainPages.length - 1) goToPage(mainCurrentPageIndex + 1); }));


            // --- 6. Ø£Ø­Ø¯Ø§Ø« Ù‚Ø³Ù… Ø§Ù„ØªØ¬ÙˆÙŠØ¯ ---
            document.getElementById('save-prep-btn').addEventListener('click', saveCurrentPreparation);
            document.getElementById('new-prep-btn').addEventListener('click', () => {
                saveCurrentPreparation();
                loadPreparation(null);
                showToast('ØªÙ… ÙØªØ­ ØµÙØ­Ø© ØªØ­Ø¶ÙŠØ± Ø¬Ø¯ÙŠØ¯Ø©', 'warning');
            });
            document.getElementById('fetch-meanings-btn').addEventListener('click', fetchMeanings);
            
            let saveTimer;
            document.getElementById('tajweed').addEventListener('change', (e) => {
                 if (e.target.classList.contains('form-input')) {
                     clearTimeout(saveTimer);
                     saveTimer = setTimeout(saveCurrentPreparation, 1000); 
                 }
            });
            document.getElementById('share-whatsapp-btn').addEventListener('click', async () => {
                showToast('Ø¬Ø§Ø±ÙŠ ØªØ­Ø¶ÙŠØ± Ø§Ù„ØµÙˆØ±Ø©...', 'warning');
                const prepElement = document.getElementById('tajweed-form-container');
                const isLight = document.documentElement.classList.contains('light');
                let bgColor = isLight ? '#f5deb3' : '#2a2a2a'; 
                
                try {
                    const canvas = await html2canvas(prepElement, { scale: 2, useCORS: true, backgroundColor: bgColor });
                    canvas.toBlob(async (blob) => {
                        const file = new File([blob], "tajweed_prep.png", { type: "image/png" });
                        const shareData = { files: [file], title: "ØªØ­Ø¶ÙŠØ± Ø­Ù„Ù‚Ø© Ø§Ù„ØªØ¬ÙˆÙŠØ¯", text: "Ù…Ø±ÙÙ‚ ØªØ­Ø¶ÙŠØ±..." };

                        if (navigator.canShare && navigator.canShare(shareData)) {
                            await navigator.share(shareData);
                        } else {
                            const dataUrl = canvas.toDataURL('image/png');
                            const link = document.createElement('a');
                            link.href = dataUrl;
                            link.download = 'tajweed_prep.png';
                            link.click();
                            showToast('ØªÙ… ØªÙ†Ø²ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©. ÙŠØ±Ø¬Ù‰ Ø¥Ø±Ø³Ø§Ù„Ù‡Ø§ ÙŠØ¯ÙˆÙŠÙ‹Ø§.', 'warning');
                        }
                    }, 'image/png');
                } catch (err) {
                    console.error('Error generating canvas:', err);
                    showToast('Ø®Ø·Ø£ ÙÙŠ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØµÙˆØ±Ø©', 'error');
                }
            });

            // --- 7. Ø£Ø­Ø¯Ø§Ø« Ù‚Ø³Ù… Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù…Ø´Ø±Ù (Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ) ---
            innerPrevBtn.addEventListener('click', () => { if (innerCurrentPageIndex > 0) { innerCurrentPageIndex--; updateInnerPageFlip(); } });
            innerNextBtn.addEventListener('click', () => { if (innerCurrentPageIndex < appData.tajweed.preparations.length - 1) { innerCurrentPageIndex++; updateInnerPageFlip(); } });
            
            innerBookContainer.addEventListener('change', (e) => {
                if (e.target.classList.contains('supervisor-note-input')) {
                    const prepId = parseInt(e.target.dataset.prepId);
                    const prep = appData.tajweed.preparations.find(p => p.id === prepId);
                    if (prep) { prep['t-supervisorNotes'] = e.target.value; saveAppData(); showToast('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©', 'success'); }
                }
            });

            // --- 8. Ø£Ø­Ø¯Ø§Ø« Ù‚Ø³Ù… Ø§Ù„Ø¬Ø§Ù…Ø¹Ø© ---
            document.getElementById('add-subject-btn').addEventListener('click', () => {
                const subjectName = prompt('Ù…Ø§ Ù‡Ùˆ Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©ØŸ');
                if (subjectName && subjectName.trim() !== '') {
                    appData.university.subjects.push({ id: Date.now(), name: subjectName, files: [] });
                    saveAppData(); renderUniversitySubjects();
                }
            });
            subjectsContainer.addEventListener('click', (e) => {
                if (e.target.classList.contains('add-pdf-btn')) { e.target.previousElementSibling.click(); }
                if (e.target.classList.contains('add-audio-btn')) { e.target.previousElementSibling.click(); }
                if (e.target.closest('.open-viewer-btn')) {
                    const btn = e.target.closest('.open-viewer-btn');
                    const subjectId = parseInt(btn.dataset.subjectId);
                    const fileId = parseInt(btn.dataset.fileId);
                    const subject = appData.university.subjects.find(s => s.id === subjectId);
                    const file = subject.files.find(f => f.id === fileId);
                    if(file) openViewer(file);
                }
            });
            subjectsContainer.addEventListener('change', (e) => {
                if (e.target.classList.contains('file-input-pdf') || e.target.classList.contains('file-input-audio')) {
                    handleFileUpload(e);
                }
            });

            // --- 9. Ø£Ø­Ø¯Ø§Ø« Ù‚Ø³Ù… Ø§Ù„ØªØ±Ø§ÙˆÙŠØ­ (Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ) ---
            tarawihGrid.addEventListener('change', (e) => {
                if (e.target.classList.contains('tarawih-input')) {
                    const day = e.target.dataset.day; const key = e.target.dataset.key;
                    if (!appData.tarawih[day]) appData.tarawih[day] = {};
                    appData.tarawih[day][key] = e.target.value; saveAppData();
                }
            });

            // --- 10. Ø£Ø­Ø¯Ø§Ø« Ù‚Ø³Ù… Ø§Ù„ØªØ®Ø·ÙŠØ· (Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ) ---
            planningWeek.addEventListener('click', (e) => {
                if (e.target.classList.contains('add-task-btn')) {
                    const day = e.target.dataset.day; const input = e.target.previousElementSibling;
                    const text = input.value.trim();
                    if (text) { 
                        // Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø© Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ø³ØªØ¨Ø¯Ø§Ù„ ÙØ§Ø±ØºØ©
                        appData.planning[day].tasks.push({ text: text, done: false }); 
                        saveAppData(); 
                        renderPlanningWeek(); 
                        input.value = ''; 
                    }
                }
            });
            planningWeek.addEventListener('change', (e) => {
                const day = e.target.dataset.day; const index = e.target.dataset.index;
                if (!day || !index) return; const task = appData.planning[day].tasks[index]; if (!task) return;
                if (e.target.classList.contains('planning-task-check')) { task.done = e.target.checked; e.target.nextElementSibling.classList.toggle('line-through', task.done); }
                if (e.target.classList.contains('planning-task-text')) { task.text = e.target.value; }
                saveAppData();
            });

            // --- 11. Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø¹Ø§Ø±Ø¶ (Modal) ---
            document.getElementById('close-modal-btn').addEventListener('click', () => {
                modal.classList.add('hidden'); viewerContent.innerHTML = '';
            });

        });
    </script>

</body>
</html>
